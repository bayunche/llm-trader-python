# 开发计划（版本 2025-11-03）

> **执行者：Codex** ｜ **更新日期：2025-11-03（UTC+8）**  
> 本计划围绕“确认现状→补齐缺口→扩展能力”三个阶段展开，所有操作需记录至 `.codex/operations-log.md`。

---

## 阶段概览

| 阶段 | 目标 | 状态 | 说明 |
| --- | --- | --- | --- |
| Phase A | 夯实数据、策略、模拟交易骨架 | ✅ 已完成 | 数据管道、LLM 策略、撮合执行与自动化已稳定运行，测试覆盖可用。 |
| Phase B | 补齐闭环缺口（报表、实盘适配） | ✅ 已完成 | 报表模块、Docker 全流程、提示词管理与模拟 live 适配器均已就绪。 |
| Phase C | 性能/监控与用户体验优化 | ✅ 已完成 | 告警扩展、仪表盘优化、风险策略与提示词多模板全部交付。 |

---

## Phase A｜基线能力（回顾）

| 模块 | 产出 | 验证 |
| --- | --- | --- |
| 数据层 | 东方财富证券/行情管道、Parquet 仓储 | `tests/data/*` |
| 策略层 | `LLMStrategyGenerator`、策略引擎 | `tests/strategy/*` |
| 交易层 | `TradingSession`、`run_ai_trading_cycle` | `tests/trading/*` |
| 自动化 | `run_full_automation`、回测验收 | `tests/pipeline/test_auto.py` |
| 监控&调度 | APScheduler 作业、Streamlit 仪表盘 | `tests/scheduler/*`、`tests/dashboard/*` |

> 以上产出已交付并通过现有自动化测试，无需重复投入。

---

## Phase B｜闭环补齐（当前重点）

| 编号 | 事项 | 内容摘要 | 负责人 | 状态 |
| --- | --- | --- | --- | --- |
| B1 | 交易模式切换与执行适配 | 在 `.env` 引入 `TRADING_EXECUTION_MODE`，重构 `TradingSession` 支持沙盒/实盘执行器注入，提供券商 API 适配层与安全配置指引。 | Codex | ✅ 已完成（默认提供 mock 券商，实现 live 流程模拟） |
| B2 | 报表模块落地 | 实现 `llm_trader.reports`（builder、loader、模板），修复 `scripts/generate_report.py` ImportError，输出 CSV/Markdown/JSON。 | Codex | ✅ 已完成 |
| B3 | Docker 一键全流程 | 优化项目结构与容器脚本，使 `docker compose up` 自动执行数据同步→策略→执行→报表→Dashboard 启动。 | Codex | ✅ 已完成 |
| B4 | 流程验证与文档 | 更新 README、项目需求、运维手册，提供沙盒/实盘验证脚本并同步 `verification.md`。 | Codex | ✅ 已完成 |
| B5 | 提示词模板管理 | 引入提示词模板管理器、默认模板与仪表盘编辑入口，确保用户可自定义策略提示词并持久化。 | Codex | ✅ 已完成 |

交付验收：  
1. `.env` 可切换沙盒/实盘模式，沙盒模式通过自动化测试验证，live 模式抛出明确提示并记录日志；  
2. 报表脚本可生成 CSV/Markdown/JSON，并在 `verification.md` 留存输出；  
3. `docker compose up` 完成全流程并自动启动 Dashboard；  
4. README/项目需求/运维文档同步反映新能力。

---

## Phase C｜增强与优化（交付总结）

| 编号 | 事项 | 依赖 | 备注 |
| --- | --- | --- | --- |
| C1 | 监控与告警扩展 | B1/B3 | ✅ 已完成（告警渠道统一、Pipeline 与风控告警、健康检查脚本）。 |
| C2 | 数据质量回归集 | B2 | ✅ 已完成（回归样本与数据质量测试）。 |
| C3 | 仪表盘性能优化 | B3 | ✅ 已完成（数据访问缓存、分页控制、日志限流，见 `tests/dashboard/test_data_access.py`）。 |
| C4 | 风控策略库 | B1 | ✅ 已完成（新增波动率、行业集中度、持仓时长阈值，见 `tests/trading/test_policy.py`）。 |
| C5 | 提示词多模板拓展 | B5 | ✅ 已完成（场景化模板、版本历史与恢复，见 `tests/strategy/test_prompts.py`）。 |

Phase C 已全部交付，进入持续验证与运维阶段。

---

## Phase D｜全链路增强（2025-11）

| 编号 | 事项 | 内容摘要 | 负责人 | 状态 |
| --- | --- | --- | --- | --- |
| D1 | 仪表盘实时交易看板 | 新增成交/订单实时视图，展示策略 ID、标的、方向、成交价/量及关联策略描述，支持定时刷新与下载。 | Codex | ✅ 已完成（2025-11-04） |
| D2 | 仪表盘图表增强 | 在交易页引入资金曲线对比、成交分布、实时行情等图表，支持多策略筛选与交互。 | Codex | ✅ 已完成（2025-11-04） |
| D3 | 自动选股策略升级 | 默认遍历全市场标的，基于最新行情的成交额/流动性排序选取前 `symbol_universe_limit` 名，并允许通过 `TRADING_SELECTION_METRIC` 配置。 | Codex | ✅ 已完成（2025-11-04） |
| D4 | 行情数据容灾 | 东方财富主表接口失败时自动切换至上交所/深交所公开数据源，保障同步稳定。 | Codex | ✅ 已完成（2025-11-04） |
| D5 | 文档与流程更新 | README 现代化、非 Docker 启动指南、自动选股/数据容灾说明全部补充；`.env.example` 提供最新配置示例。 | Codex | ✅ 已完成（2025-11-04） |
> Phase D 的未完项（D1~D3）需在实现前完成 `.codex` 规划/任务拆解，并补充对应测试、文档与验证记录。

---

## Phase E｜多端集成（规划阶段）

| 编号 | 事项 | 内容摘要 | 负责人 | 状态 |
| --- | --- | --- | --- | --- |
| E1 | Tauri 多端应用打包 | 在项目功能完善后，使用 Tauri 将自动化脚本、仪表盘与监控能力整合为跨平台桌面应用，提供统一入口（任务启动、日志查看、状态监控等）。 | Codex | 📝 待规划 |

> Phase E 目前处于规划阶段，待 Phase D 核心功能稳定后再启动详细设计与实现。

---

## 工作约束与流程

1. 所有开发任务须先通过 `.codex` 系列工具完成思考、计划、拆解。  
2. 每个任务需要：实现、测试、文档、验证报告四项齐全。  
3. 测试统一执行 `env PYTHONPATH=src python -m pytest`，若新增脚本需在 `verification.md` 记录。  
4. 文档更新（README、项目需求、设计文档等）必须写明日期与执行者身份。  
5. 任何涉及外部接口的实现需提供可配置的 Mock/适配层以便离线验证。  
6. 操作日志：关键指令、工具调用、失败原因需记录在 `.codex/operations-log.md`，保持可追溯。  

如需调整计划，请更新本文件并同步通知相关文档。
